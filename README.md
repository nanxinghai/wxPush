## å¾®ä¿¡æµ‹è¯•å…¬ä¼—å·æ¨é€æœåŠ¡

#### 1ã€å®Œæˆæ•ˆæœğŸ˜ƒ

â“ï¼šä¸ºä»€ä¹ˆå…ˆè¯´å®Œæˆçš„æ•ˆæœå‘¢ï¼Ÿ

ğŸ™‹ï¼šå°±åƒå°„ç®­ğŸ¹æ‰¾ä¸åˆ°ç®­é¶ğŸ§¿ï¼Œé‚£æ¯å¤©æ‹‰å¼“çš„æ„ä¹‰åœ¨å“ªå‘¢ï¼Ÿ

å…ˆæ¥äº†è§£ä¸€ä¸‹æœ¬æ¬¡ç»ƒä¹ è¦å®ç°çš„æ•ˆæœã€ç»“æœã€‚

> é€šè¿‡ä»£ç ç¼–å†™ï¼Œé¡¹ç›®éƒ¨ç½²ï¼Œèƒ½è¾¾åˆ°è®©ç”¨æˆ·å…³æ³¨æ”¹å…¬ä¼—å·åï¼Œæ¯å¤©å®šæ—¶æ¨é€ï¼ˆä½ æƒ³è¦çš„æ¶ˆæ¯ï¼‰ï¼Œä¾‹å¦‚ï¼šå¤©æ°”é¢„æŠ¥æ¨é€ã€ç”Ÿæ—¥æ¨é€ã€ç–«æƒ…ç›¸å…³æ•°æ®æ¨é€ï¼ˆæ„ŸæŸ“äººæ•°ã€é£é™©åœ°åŒºï¼‰

![image-20220904024839012](https://raw.githubusercontent.com/nanxinghai/PicGo/main/202209040248148.png)

ä¸Šé¢äºŒç»´ç æ˜¯æ¥¼ä¸»è‡ªå·±åšçš„ï¼Œæ„Ÿå…´è¶£çš„è¯å¯ä»¥æ‰«ç ä½“éªŒä½“éªŒ

#### 2ã€èƒ½å­¦ä¹ åˆ°çš„ä¸€äº›çŸ¥è¯†ç‚¹

å®Œæˆæ­¤ç»ƒä¹ çš„å‰æï¼š1ã€æ‹¥æœ‰javaä»£ç åŸºç¡€	2ã€æœ‰ä¸€å°äº‘æœåŠ¡å™¨æˆ–è€…æ°¸ä¸å…³æœºçš„ç”µè„‘ğŸ’»ï¼ˆæ‰èƒ½å®ç°æ¯å¤©å®šç‚¹æ¨é€ï¼‰ï¼ˆçœ‹ç½‘ä¸Šè¯´ä½¿ç”¨githubä¹Ÿèƒ½å®ç°å®šæ—¶æ¨é€ï¼‰

æœ¬ç»ƒä¹ ä½¿ç”¨	JAVA	è¯­è¨€å®ç°ï¼ŒçŸ¥è¯†ç‚¹åŒ…æ‹¬ï¼š

- SpringBootæ¡†æ¶çš„åŸºæœ¬ä½¿ç”¨ï¼ˆaopç›¸å…³ã€å®šæ—¶ä»»åŠ¡ç›¸å…³ï¼‰
- ç›¸å…³å·¥å…·åŒ…ä½¿ç”¨ï¼ˆHutoolå·¥å…·åŒ…ï¼‰
- ç¬¬ä¸‰æ–¹æ¥å£å¯¹æ¥ï¼ˆå¾®ä¿¡å…¬ä¼—å·ã€è…¾è®¯åœ°å›¾ã€å¤©æ°”apiã€å¤©è¡Œæ•°æ®æ¯æ—¥ä¸€å¥ã€è‹±è¯­ç¿»è¯‘apiï¼‰

#### 3ã€å¼€å§‹

##### 3.1ã€æ³¨å†Œå¾®ä¿¡æµ‹è¯•å…¬ä¼—å·

[https://mp.weixin.qq.com/debug/cgi-bin/sandbox?t=sandbox/login](https://mp.weixin.qq.com/debug/cgi-bin/sandbox?t=sandbox/login)

![image-20220904031113814](https://raw.githubusercontent.com/nanxinghai/PicGo/main/202209040311998.png)

ç‚¹å‡»æ­¤é“¾æ¥ï¼Œä½¿ç”¨å¾®ä¿¡æ‰«ç ç™»å½•åï¼Œä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªæµ‹è¯•å…¬ä¼—å·ï¼Œé‡ç‚¹æ³¨æ„appIDã€appsecretï¼ˆç­‰ä¼šè¦ç”¨ï¼‰è®°ä½è‡ªå·±çš„å°±è¡Œï¼Œæˆ‘è¿™é‡Œæ‰“ç ä¸ºäº†è´¦å·å®‰å…¨

![image-20220904031326912](https://raw.githubusercontent.com/nanxinghai/PicGo/main/202209040313003.png)

##### 3.2ã€åˆ†ç±»

åˆ†ä¸ºä¸¤ç§ï¼šï¼ˆè¿™ä¸ªåˆ†ç±»æ˜¯æˆ‘è‡ªå·±å–çš„åå­—ï¼Œä¸æ˜¯å¾®ä¿¡å®˜æ–¹çš„ï¼‰

###### 1ã€å›ºå®šç±»æ¨é€æ¶ˆæ¯

â“ï¼šå›ºå®šç±»æ¨é€ï¼Ÿä»€ä¹ˆæ„æ€ï¼Ÿ

ğŸ™‹ï¼šå°±æ˜¯å¯¹æ¯ä¸€ä¸ªå…³æ³¨è€…éƒ½æ¨é€å‡ ä¹ç›¸åŒçš„ä¸œè¥¿ï¼Œä¸å¤ªé€šç”¨ï¼Œä¾‹å¦‚ä¸Šé¢å›¾ç‰‡ä¸­çš„æ˜Ÿåº§ï¼Œæ¯ä¸ªå…³æ³¨è€…å¯èƒ½æ˜¯ä¸åŒçš„ï¼Œå›ºå®šç±»å°±ç›¸å½“äºæŠŠå®ƒå†™æ­»

â“ï¼šå›ºå®šç±»æ¨é€æœ‰ä»€ä¹ˆå¥½å¤„/ä¼˜åŠ£å—ï¼Ÿ

ğŸ™‹ï¼šä»£ç ç›¸å¯¹ç®€å•ã€é€‚ç”¨äºåªç»™ä¸€ä¸ªäººæ¨é€æ¶ˆæ¯ï¼Œç®€æ˜“ç‰ˆå¼€æºåœ°å€ï¼š[https://github.com/nanxinghai/wxPushEasy](https://github.com/nanxinghai/wxPushEasy)

###### 2ã€é€šç”¨ç±»æ¨é€æ¶ˆæ¯

ğŸ™‹ï¼šé€šç”¨ç±»å°±æ˜¯ä¼šå¯¹æ¯ä¸€ä¸ªå…³æ³¨è€…å‘é€çš„æ¶ˆæ¯ä¼šæœ‰ä¸åŒã€‚æ¯”å¦‚æ˜Ÿåº§ï¼Œç”¨æˆ·å…³æ³¨åï¼Œå…¬ä¼—å·æ€ä¹ˆçŸ¥é“å…³æ³¨è€…çš„æ˜Ÿåº§ï¼Œéœ€è¦å…³æ³¨è€…è‡ªè¡Œè®¾ç½®ç”Ÿæ—¥ï¼Œç„¶åå­˜å‚¨åˆ°æ•°æ®åº“ä¸­ï¼Œå†å‘é€æ¶ˆæ¯æ¨¡æ¿æ—¶ï¼Œè¯»å–å…³æ³¨è€…çš„ç”Ÿæ—¥ï¼Œæ‰èƒ½çŸ¥é“å…¶æ˜Ÿåº§ï¼ˆå¦‚æœæ²¡æ‡‚ï¼Œå¯ä»¥æ‰«ç å…³æ³¨æœ€ä¸Šé¢çš„äºŒç»´ç ä½“éªŒä½“éªŒï¼‰

ğŸ™‹ï¼šä»£ç ç›¸å¯¹å¤æ‚ä¸€äº›ã€æœ‰é€šç”¨æ€§

##### 3.3ã€åˆ›å»ºSpringBooté¡¹ç›®

mavenä¾èµ–ï¼š

```xml
<parent>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-parent</artifactId>
        <version>2.4.3</version>
</parent>
<dependencies>
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-starter-web</artifactId>
    </dependency>

    <!-- https://mvnrepository.com/artifact/com.github.binarywang/weixin-java-mp -->
    <!-- å¾®ä¿¡æµ‹è¯•å…¬ä¼—å·ä¸‰æ–¹å¯¹æ¥åŒ… -->
    <dependency>
        <groupId>com.github.binarywang</groupId>
        <artifactId>weixin-java-mp</artifactId>
        <version>3.3.0</version>
    </dependency>

    <!--Hutoolå·¥å…·åŒ…-->
    <dependency>
        <groupId>cn.hutool</groupId>
        <artifactId>hutool-all</artifactId>
        <version>5.7.16</version>
    </dependency>
    <!--lombok-->
    <dependency>
        <groupId>org.projectlombok</groupId>
        <artifactId>lombok</artifactId>
    </dependency>

    <!-- springbootæµ‹è¯•-->
    <dependency>
        <groupId>org.springframework.boot</groupId>
        <artifactId>spring-boot-test</artifactId>
    </dependency>
    <dependency>
        <groupId>org.springframework</groupId>
        <artifactId>spring-test</artifactId>
    </dependency>
    <dependency>
        <groupId>junit</groupId>
        <artifactId>junit</artifactId>
        <version>4.12</version>
    </dependency>
</dependencies>
```

##### 3.3ã€å°è¯•ç‰›åˆ€ğŸ”ª

å…ˆæ¥åšä¸ªæœ€ç®€å•çš„æ¨é€ï¼Œæ˜ç™½å…¶è¿‡ç¨‹ï¼Œåé¢è‡ªç„¶å°±é€š

å°†ä½ æ³¨å†Œçš„æµ‹è¯•å…¬ä¼—å·çš„appiDå’Œappsecretå†™ä¸Šå»ï¼Œè§£è€¦

```yml
wx:
  appID: ä½ çš„appID
  appsecret: ä½ çš„appsecret
```

å†™ä¸€ä¸ªç±»ï¼Œç±»åéšä¾¿

```java
@Component
public class SendController {
    @Value("${wx.appID}")
    private String appID;
    @Value("${wx.appsecret}")
    private String appsecret;

    public void push(){
        //1ï¼Œé…ç½®
        WxMpInMemoryConfigStorage wxStorage = new WxMpInMemoryConfigStorage();
        wxStorage.setAppId(appID);
        wxStorage.setSecret(appsecret);
        WxMpService wxMpService = new WxMpServiceImpl();
        wxMpService.setWxMpConfigStorage(wxStorage);
        //2,æ¨é€æ¶ˆæ¯
        WxMpTemplateMessage templateMessage = WxMpTemplateMessage.builder()
                .toUser("ç”¨æˆ·åˆ—è¡¨å¾®ä¿¡å·")
                .templateId("æ¨¡æ¿id")
                .build();
        //3,å‘é€æ¨¡ç‰ˆæ¶ˆæ¯ï¼Œè¿™é‡Œéœ€è¦é…ç½®ä½ çš„ä¿¡æ¯
        templateMessage.addData(new WxMpTemplateData("today","2022-09-04 æ˜ŸæœŸæ—¥","#00BFFF"));
        templateMessage.addData(new WxMpTemplateData("city","æˆéƒ½","#4169E1"));
        try {
            System.out.println(templateMessage.toJson());
            wxMpService.getTemplateMsgService().sendTemplateMsg(templateMessage);
        } catch (Exception e) {
            System.out.println("æ¨é€å¤±è´¥ï¼š" + e.getMessage());
            e.printStackTrace();
        }
    }

}
```

â“ï¼šä½ å¯èƒ½ç–‘æƒ‘	â€œç”¨æˆ·åˆ—è¡¨å¾®ä¿¡å·â€ã€â€œæ¨¡æ¿idâ€æ˜¯ä»€ä¹ˆï¼Ÿ

ğŸ™‹ï¼šç”¨æˆ·å¾®ä¿¡å·å°±æ˜¯æŒ‡ä½ è¦å‘ç»™è°ï¼Ÿ

åœ¨åˆšåˆšåˆ›å»ºå¥½çš„æµ‹è¯•å…¬ä¼—å·çš„é¡µé¢ä¸Šï¼Œä¼šæœ‰ä¸€ä¸ªäºŒç»´ç ï¼Œç”¨æˆ·åœ¨å…³æ³¨ä½ çš„å…¬ä¼—å·ä¹‹åï¼Œå°±ä¼šå‡ºç°å…³æ³¨è€…çš„å¾®ä¿¡å·ï¼Œä»£ç é‡Œé¢å¡«ä¸€ä¸ªå°±è¡Œ

![image-20220904035132926](https://raw.githubusercontent.com/nanxinghai/PicGo/main/202209040351035.png)

â“ï¼šæ¨¡æ¿idåˆæ˜¯ä»€ä¹ˆï¼Ÿ

ğŸ™‹ï¼šé¦–å…ˆçš„åˆ›å»ºä¸€ä¸ªæ¨¡æ¿ï¼Œæ‰èƒ½æœ‰æ¨¡æ¿id

â“ï¼šæ€ä¹ˆåˆ›å»ºå‘¢ï¼Ÿ

ğŸ™‹ï¼šåœ¨æµ‹è¯•å…¬ä¼—å·é¡µé¢ï¼Œå¾€ä¸‹æ‹‰å¯ä»¥çœ‹åˆ°åˆ›å»ºæ¨¡æ¿

![image-20220904225414379](https://raw.githubusercontent.com/nanxinghai/PicGo/main/202209042254524.png)

åœ¨docç›®å½•ä¸‹æœ‰ç¤ºä¾‹æ¨¡æ¿æ–‡ä»¶ï¼Œåœ¨æ¨¡æ¿æ–‡ä»¶ä¸­æ•°æ®åŸŸå¿…é¡»ä»¥.DATAç»“å°¾ï¼Œæ¨¡æ¿å†…å®¹å†™ä»€ä¹ˆï¼Œå°±ä¼šæ¨é€ä»€ä¹ˆå†…å®¹ç»™ç”¨æˆ·

![image-20220905014401982](https://raw.githubusercontent.com/nanxinghai/PicGo/main/202209050144145.png)

å†™æµ‹è¯•ç±»æµ‹è¯•

```java
@RunWith(SpringRunner.class)
@SpringBootTest(classes = {cn.simon.WxTianqiApplication.class})
public class SendTest {

    @Autowired
    private SendController sendController;

    @Test
    public void testSend(){
        sendController.push();
    }
}
```

å¦‚æœæµ‹è¯•æˆåŠŸï¼Œæˆ‘æƒ³ä½ çš„æ‰‹æœºå·²ç»æ”¶åˆ°äº†æ¶ˆæ¯ã€‚é‚£ä¹ˆæ­å–œä½ ï¼Œå·²ç»å¤§éƒ¨åˆ†å®Œæˆäº†è¿™ä¸ªå¾®ä¿¡å…¬ä¼—å·æ¨é€ï¼Œå¯ä»¥è¯´ç›¸å½“äºæ˜¯å®Œæˆäº†80%

##### 3.4ã€å†æ¥å†å‰ğŸ˜

å¦‚æœä½ å·²ç»æˆåŠŸå®Œæˆä¸Šé¢æ­¥éª¤ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥ï¼Œåªéœ€è¦å°†åœ°å€ï¼Œå¤©æ°”ï¼Œæ—¥æœŸï¼Œæ˜Ÿåº§æ”¹æˆåŠ¨æ€å†…å®¹å³å¯ã€‚å³å¯¹æ¥ç¬¬ä¸‰æ–¹æ¥å£ã€‚

**æ—¥æœŸæ ¼å¼ä»£ç ï¼š**

```java
/**
*	å°†ä»Šæ—¥æ—¥æœŸè½¬æ¢æˆyyyy-MM-dd Eï¼š2022-09-09 æ˜ŸæœŸå›› 
*/
public static String format(){
        SimpleDateFormat myFmt3 = new SimpleDateFormat("yyyy-MM-dd E");
        Date now = new Date();
        return myFmt3.format(now);
}
```

**å¯¹æ¥å¤©æ°”æ¥å£ä»£ç ï¼š**

æ¥å£åœ°å€æ˜¯ä¸­åä¸‡å¹´å†çš„å¤©æ°”API

è¯·æ±‚æ–¹å¼ï¼šGET

è¯·æ±‚åœ°å€ï¼š

```apl
http://wthrcdn.etouch.cn/WeatherApi?city=åŸå¸‚å
```

è¿”å›æ•°æ®ï¼š

1.æ•°æ®åŒ…æ‹¬æ¸©åº¦ã€æ¹¿åº¦ã€é£åŠ›ã€é£å‘ã€æ—¥å‡ºæ—¶é—´ã€æ—¥è½æ—¶é—´

2.æ”¯æŒä¸€äº›å¤©æ°”æŒ‡æ•°å’Œç©¿è¡£å»ºè®®ç­‰

3.è¿”å›æ•°æ®ä¸ºxmlï¼Œæ‰€ä»¥æˆ‘ä»¬è¦å¤„ç†è§£æxml

è¯·æ±‚ç¤ºä¾‹ï¼š

```apl
http://wthrcdn.etouch.cn/WeatherApi?city=ä¸Šæµ·
```

è¿”å›ç»“æœç¤ºä¾‹ï¼š

```xml
<resp>
  <city>ä¸Šæµ·</city>
  <updatetime>16:46</updatetime>
  <wendu>28</wendu>
  <fengli>
    <![CDATA[ 1çº§ ]]>
  </fengli>
  <shidu>43%</shidu>
  <fengxiang>ä¸œå—é£</fengxiang>
  <sunrise_1>04:49</sunrise_1>
  <sunset_1>18:57</sunset_1>
.....
</resp>
```

å®æˆ˜ï¼š

1ã€åˆ©ç”¨Hutoolçš„ HttpUtil å‘é€è¯·æ±‚

```java
public void getAll(){
        String url = "http://wthrcdn.etouch.cn/WeatherApi";
        HashMap<String, Object> param = new HashMap<>();
        param.put("city","æˆéƒ½");
        String response = HttpUtil.get(url, param);
        System.out.println(response);
}
```

2ã€å†å¯ä»¥åˆ©ç”¨Hutoolçš„ XmlUtil å¯¹è¿”å›çš„xmlè§£æ

```java
Document document = XmlUtil.parseXml(xml);
        String city = (String) XmlUtil.getByXPath("//resp/city", document, XPathConstants.STRING);
```

å°†xmlå­—ç¬¦ä¸²ä¼ å…¥parseXmlæ–¹æ³•ä¸­å¾—åˆ°Documentå¯¹è±¡ä¸­ï¼Œå†åˆ©ç”¨getByXPathæ–¹æ³•èƒ½ç›´æ¥å°†æƒ³è¦çš„

å†…å®¹

å¦‚æœä½ æƒ³è¦çš„å†…å®¹åœ¨xmlèŠ‚ç‚¹é‡Œæœ‰å¤šä¸ªï¼Œç±»ä¼¼è¿™æ ·

```xml
<resp>
    ......
    <zhishus>
        <zhishu>
          <name>ç©¿è¡£æŒ‡æ•°</name>
          <value>è–„æ¬¾æ˜¥å¤è£…</value>
          <detail>å¤©æ°”èˆ’é€‚ï¼Œå»ºè®®ç©¿ç€è–„æ¬¾ï¼Œé€æ°”çš„è¡£ç‰©ã€‚æ¨èï¼šé•¿Tã€é•¿è£™ã€é•¿è£¤ç­‰ã€‚</detail>
        </zhishu>
        <zhishu>
          <name>ç´«å¤–çº¿å¼ºåº¦</name>
          <value>ç´«å¤–çº¿è¾ƒå¼±</value>
          <detail>ç´«å¤–çº¿å¼ºåº¦å¼±ï¼Œå¤–å‡ºè®°å¾—æ¶‚é˜²æ™’éœœï¼Œé¿å…çš®è‚¤å—åˆ°å¤ªé˜³è¾å°„çš„å±å®³ã€‚</detail>
        </zhishu>
        <zhishu>
          <name>æŠ¤è‚¤æŒ‡æ•°</name>
          <value>å¸¸è§„æŠ¤è‚¤</value>
          <detail>ç©ºæ°”é€‚å®œï¼Œè¯·æ ¹æ®çš®è‚¤ç±»å‹ï¼Œé€‰æ‹©é€‚åˆçš„å¸¸è§„æŠ¤è‚¤å“ã€‚</detail>
        </zhishu>
        <zhishu>
          <name>æ´—è½¦æŒ‡æ•°</name>
          <value>è¾ƒé€‚å®œæ´—è½¦</value>
          <detail>ä»Šæ˜ä¸¤æ—¥å¤©æ°”è¾ƒå¥½ï¼Œå¯ä»¥æ”¾å¿ƒæ´—è½¦ã€‚</detail>
        </zhishu>
    </zhishus>
</resp>
```

è€Œæˆ‘æƒ³è¦å…¶ä¸­ä¸€ä¸ªdetailèŠ‚ç‚¹å†…å®¹

é‚£ä¹ˆåªèƒ½åˆ©ç”¨å¾ªç¯äº†

```java
List<String> details = new ArrayList<String>();
try {
    org.dom4j.Document parseText = DocumentHelper.parseText(xml);
    Element rootElement = parseText.getRootElement();
    Element element = rootElement.element("zhishus");
    //éå†æŸä¸ªå­èŠ‚ç‚¹ï¼Œå¦‚resultcode
    for (Iterator i = element.elementIterator("zhishu"); i.hasNext(); ){
        Element  next = (Element) i.next();
        Element detail = next.element("detail");
        String text = detail.getText();
        details.add(text);
    }
} catch (DocumentException e) {
    e.printStackTrace();
}
```

**è®¡ç®—è·ç¦»ç”Ÿæ—¥å¤©æ•°ä»£ç ï¼š**

```java
/**
*  è®¡ç®—è·ç¦»ç”Ÿæ—¥è¿˜æœ‰å¤šå°‘å¤©
* @param addtimeï¼šå‚æ•°:ç”Ÿæ—¥æ—¥æœŸ ä¾‹å¦‚ï¼š2022-09-09
*/
public static int getBirthDay(String addtime) {
    int days = 0;
    try {
        SimpleDateFormat myFormatter = new SimpleDateFormat("yyyy-MM-dd");
        String clidate = addtime;
        Calendar cToday = Calendar.getInstance(); // å­˜ä»Šå¤©
        Calendar cBirth = Calendar.getInstance(); // å­˜ç”Ÿæ—¥
        cBirth.setTime(myFormatter.parse(clidate)); // è®¾ç½®ç”Ÿæ—¥
        cBirth.set(Calendar.YEAR, cToday.get(Calendar.YEAR)); // ä¿®æ”¹ä¸ºæœ¬å¹´
        if (cBirth.get(Calendar.DAY_OF_YEAR) < cToday.get(Calendar.DAY_OF_YEAR)) {
            // ç”Ÿæ—¥å·²ç»è¿‡äº†ï¼Œè¦ç®—æ˜å¹´çš„äº†
            days = cToday.getActualMaximum(Calendar.DAY_OF_YEAR) - cToday.get(Calendar.DAY_OF_YEAR);
            days += cBirth.get(Calendar.DAY_OF_YEAR);
        } else {
            // ç”Ÿæ—¥è¿˜æ²¡è¿‡
            days = cBirth.get(Calendar.DAY_OF_YEAR) - cToday.get(Calendar.DAY_OF_YEAR);
        }
    } catch (ParseException e) {
        e.printStackTrace();
    }
    return days;
}
```

**å®šæ—¶ä»»åŠ¡ï¼š**

éœ€åœ¨å¯åŠ¨ç±»ä¸ŠåŠ æ³¨è§£@EnableScheduling   // è¡¨ç¤ºå¼€å¯å®šæ—¶ä»»åŠ¡

```java
@EnableScheduling
```

åœ¨éœ€è¦æ‰§è¡Œå®šæ—¶ä»»åŠ¡çš„æ–¹æ³•ä¸Šæ³¨è§£@Scheduled

```java
@Scheduled(cron = "0 30 9 * * ? ")
public void push(){
    //æ¯å¤©å®šæ—¶9ç‚¹åŠæ‰§è¡Œé€»è¾‘
}
```

##### 3.5ã€æ›´ä¸Šä¸€å±‚ğŸ˜€

å¦‚æœæƒ³å®ç°é€šç”¨ç±»æ¨é€æ¶ˆæ¯ï¼Œéœ€è¦è·Ÿç”¨æˆ·äº¤äº’ï¼Œæ€è·¯ï¼šç”¨æˆ·å…³æ³¨åï¼Œä¸»åŠ¨æ¨é€æ¶ˆæ¯ï¼ˆæ¶ˆæ¯å†…å®¹å°±æ˜¯å«ç”¨æˆ·å›å¤æ¶ˆæ¯ï¼‰ï¼Œè®¾ç½®ç”Ÿæ—¥ï¼Œæ˜µç§°ç­‰ä¿¡æ¯ï¼Œç„¶åå­˜åˆ°åº“ä¸­ï¼Œç„¶åæ¯æ¬¡å‘é€æ¶ˆæ¯æ—¶ï¼Œä»åº“ä¸­è¯»å–å‡ºæ¥

**1.ç”¨æˆ·å…³æ³¨åï¼Œä¸»åŠ¨æ¨é€æ¶ˆæ¯ä½ å·²ç»ä¼šäº†ï¼Œç•¥**

**2.ç”¨æˆ·å‘é€æ¶ˆæ¯åï¼Œæˆ‘ä»¬è¦æ‹¿åˆ°ç”¨æˆ·å‘é€çš„å†…å®¹**

ç”¨æˆ·å‘é€æ¶ˆæ¯åï¼Œæˆ‘ä»¬è¦æ‹¿åˆ°ç”¨æˆ·å‘é€çš„å†…å®¹ï¼Œå°†å†…å®¹å­˜åˆ°æ•°æ®åº“ä¸­ï¼ˆåŒ…æ‹¬å…³æ³¨ç”¨æˆ·idï¼‰

å¾®ä¿¡å…¬ä¼—å·æœ‰ä¸€ç³»åˆ—çš„æ¥å£ï¼Œæ¯”å¦‚æˆ‘ä»¬è¦ç”¨åˆ°çš„æ¥å—æ¶ˆæ¯æ¥å£ï¼Œä½ å°±å¯ä»¥æ‹¿åˆ°ç”¨æˆ·ç»™ä½ å‘çš„æ¶ˆæ¯å†…å®¹

![image-20220907005338118](https://raw.githubusercontent.com/nanxinghai/PicGo/main/202209070053247.png)

![image-20220909005107579](https://raw.githubusercontent.com/nanxinghai/PicGo/main/202209090051703.png)

æŸ¥çœ‹æ¥å£æ–‡æ¡£å‘ç°ï¼š

å½“å…³æ³¨ç”¨æˆ·ç»™ä½ å‘é€æ¶ˆæ¯åï¼Œå¾®ä¿¡æœåŠ¡å™¨ä¼šç”¨postè¯·æ±‚æ¥è¯·æ±‚ä½ çš„URLï¼Œä¼šå°†xmlæ•°æ®åŒ…æ”¾å…¥è¾“å…¥æµä¸­ï¼Œè¿™é‡Œæœ‰æ–¹æ³•å¯ä»¥å°†requestå¯¹è±¡ä¸­çš„xmlè¯»å–å‡ºæ¥

```java
/**
* dom4j è§£æ xml è½¬æ¢ä¸º map
* @param request
* @return
* @throws Exception
*/
public static Map<String, String> parseXml(HttpServletRequest request) throws Exception {
    // å°†è§£æç»“æœå­˜å‚¨åœ¨HashMapä¸­
    Map<String, String> map = new HashMap<String, String>();
    // ä»requestä¸­å–å¾—è¾“å…¥æµ
    InputStream inputStream = request.getInputStream();
    // è¯»å–è¾“å…¥æµ
    SAXReader reader = new SAXReader();
    Document document = reader.read(inputStream);
    // å¾—åˆ°xmlæ ¹å…ƒç´ 
    Element root = document.getRootElement();
    // å¾—åˆ°æ ¹å…ƒç´ çš„æ‰€æœ‰å­èŠ‚ç‚¹
    List<Element> elementList = root.elements();

    // éå†æ‰€æœ‰å­èŠ‚ç‚¹
    for (Element e : elementList) {
        map.put(e.getName(), e.getText());
    }
    // é‡Šæ”¾èµ„æº
    inputStream.close();
    return map;
}
```

â“ï¼šå¾®ä¿¡æœåŠ¡å™¨æ€ä¹ˆçŸ¥é“æˆ‘çš„URLæ˜¯å¤šå°‘å‘¢ï¼Ÿ

ğŸ™‹ï¼šåœ¨å…¬ä¼—å·é¡µé¢å¯ä»¥çœ‹åˆ°å¡«å†™URLé€‰é¡¹

![image-20220909010136604](https://raw.githubusercontent.com/nanxinghai/PicGo/main/202209090101745.png)

å…¶ä¸­çš„URLä¾¿æ˜¯æ˜ å°„åˆ°ä½ çš„æ¥å£åœ°å€

![image-20220909010243128](https://raw.githubusercontent.com/nanxinghai/PicGo/main/202209090102231.png)

TOKENæ˜¯éšä¾¿å†™ä»€ä¹ˆéƒ½å¯ä»¥ï¼Œä½†æ˜¯å¿…é¡»ä¿è¯åœ¨éªŒç­¾æ—¶ä¸ä¹‹ç›¸åŒ

â“ï¼šéªŒç­¾æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ

ğŸ™‹ï¼šä½ å¯ä»¥ç‚¹å¼€å…¬ä¼—å·é¡µé¢çš„æ¶ˆæ¯æ¥å£ä½¿ç”¨æŒ‡å—

![image-20220909010841255](https://raw.githubusercontent.com/nanxinghai/PicGo/main/202209090108363.png)

![image-20220909010907060](https://raw.githubusercontent.com/nanxinghai/PicGo/main/202209090109194.png)

å¦‚å›¾æ‰€ç¤ºï¼Œå¾®ä¿¡æœåŠ¡å™¨ä¼šä»¥GETè¯·æ±‚å‘é€4ä¸ªå‚æ•°ï¼Œå¦‚æœåŠ å¯†å¯¹æ¯”ç›¸åŒï¼Œè¿”å›echostréšæœºå­—ç¬¦ä¸²å³å¯éªŒç­¾æˆåŠŸï¼Œå¦‚æœéªŒç­¾å¤±è´¥ï¼Œæ˜¯ä¸èƒ½é…ç½®URLé€‰é¡¹çš„ï¼Œç”±äºä½ çš„URLå¿…é¡»èƒ½åœ¨å…¬ç½‘ä¸Šè®¿é—®ï¼Œæ‰€ä»¥åœ¨å¼€å‘æ—¶å¯ä»¥ä½¿ç”¨å†…ç½‘ç©¿é€

```java
@RequestMapping("/getconn")
public String connection(HttpServletRequest request, HttpServletResponse response){
    PrintWriter out = null;
    // https://developers.weixin.qq.com/doc/offiaccount/Basic_Information/Access_Overview.html
    String signature=request.getParameter("signature");
    String timestamp=request.getParameter("timestamp");
    String nonce=request.getParameter("nonce");
    String echostr=request.getParameter("echostr");

    boolean isCheck = CheckOutUtil.checkSignature(signature, timestamp, nonce);
    if(isCheck){
        logger.info("éªŒç­¾æˆåŠŸ!");
        return echostr;
    }
    if(!isCheck){
        logger.info("éªŒç­¾å¤±è´¥!");
        return null;
    }
}
```

CheckOutUtilå·¥å…·ç±»èƒ½å®ŒæˆéªŒç­¾åŠŸèƒ½

```java
/**
 * @author ï¼šSimon
 * @date ï¼šCreated in 2022/8/24 23:12
 * @descriptionï¼šç­¾åè®¤è¯å·¥å…·ç±»
 * @modified Byï¼š
 * @version: v1.0
 */
public class CheckOutUtil {
    // ä¸æ¥å£é…ç½®ä¿¡æ¯ä¸­çš„Tokenè¦ä¸€è‡´
    private static String token = "zhangsan";

    /**
     * éªŒè¯ç­¾å
     *
     * @param signature
     * @param timestamp
     * @param nonce
     * @return
     */
    public static boolean checkSignature(String signature, String timestamp, String nonce) {
        String[] arr = new String[] { token, timestamp, nonce };
        // å°†tokenã€timestampã€nonceä¸‰ä¸ªå‚æ•°è¿›è¡Œå­—å…¸åºæ’åº
        // Arrays.sort(arr);
        sort(arr);
        StringBuilder content = new StringBuilder();
        for (int i = 0; i < arr.length; i++) {
            content.append(arr[i]);
        }
        MessageDigest md = null;
        String tmpStr = null;

        try {
            md = MessageDigest.getInstance("SHA-1");
            // å°†ä¸‰ä¸ªå‚æ•°å­—ç¬¦ä¸²æ‹¼æ¥æˆä¸€ä¸ªå­—ç¬¦ä¸²è¿›è¡Œsha1åŠ å¯†
            byte[] digest = md.digest(content.toString().getBytes());
            tmpStr = byteToStr(digest);
        } catch (NoSuchAlgorithmException e) {
            e.printStackTrace();
        }
        content = null;
        // å°†sha1åŠ å¯†åçš„å­—ç¬¦ä¸²å¯ä¸signatureå¯¹æ¯”ï¼Œæ ‡è¯†è¯¥è¯·æ±‚æ¥æºäºå¾®ä¿¡

        return tmpStr != null ? tmpStr.equals(signature.toUpperCase()) : false;
    }

    /**
     * å°†å­—èŠ‚æ•°ç»„è½¬æ¢ä¸ºåå…­è¿›åˆ¶å­—ç¬¦ä¸²
     *
     * @param byteArray
     * @return
     */
    private static String byteToStr(byte[] byteArray) {
        String strDigest = "";
        for (int i = 0; i < byteArray.length; i++) {
            strDigest += byteToHexStr(byteArray[i]);
        }
        return strDigest;
    }

    /**
     * å°†å­—èŠ‚è½¬æ¢ä¸ºåå…­è¿›åˆ¶å­—ç¬¦ä¸²
     *
     * @param mByte
     * @return
     */
    private static String byteToHexStr(byte mByte) {
        char[] Digit = { '0', '1', '2', '3', '4', '5', '6', '7', '8', '9', 'A', 'B', 'C', 'D', 'E', 'F' };
        char[] tempArr = new char[2];
        tempArr[0] = Digit[(mByte >>> 4) & 0X0F];
        tempArr[1] = Digit[mByte & 0X0F];
        String s = new String(tempArr);
        return s;
    }
    public static void sort(String a[]) {
        for (int i = 0; i < a.length - 1; i++) {
            for (int j = i + 1; j < a.length; j++) {
                if (a[j].compareTo(a[i]) < 0) {
                    String temp = a[i];
                    a[i] = a[j];
                    a[j] = temp;
                }
            }
        }
    }
}
```

å…·ä½“çš„è§£æå®Œxmlåï¼Œä½ å°±å¯ä»¥å®Œæˆä»»ä½•æƒ³å®Œæˆçš„äº‹æƒ…

```java
Map<String, String> map = CheckOutUtil.parseXml(request);
System.out.println(map);
String event = map.get("Event");
String msgType = map.get("MsgType");
String fromUserName = map.get("FromUserName");
String toUserName = map.get("ToUserName");
```

éƒ¨ç½²ç›¸å…³å¯ä»¥æŸ¥çœ‹DEPLOY.md

è¯•è¯•çœ‹å§ï¼å¦‚æœä½ è¿˜æœ‰æ›´å¤šç–‘æƒ‘å’Œé—®é¢˜ï¼Œæˆ–è€…æœ‰æ›´å¤šè§è§£çš„åœ°æ–¹ï¼Œå¯ä»¥åŠ æˆ‘qï¼Œæˆ‘ä¼šè§£ç­”ä½ çš„ç–‘æƒ‘

qqï¼š2830224482

Githubå¼€æºï¼š[https://github.com/nanxinghai/wxPush](https://github.com/nanxinghai/wxPush)

Giteeå¼€æºï¼š[https://gitee.com/xiaoerff/wxPush](https://gitee.com/xiaoerff/wxPush)